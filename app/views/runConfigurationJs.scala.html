@(testCase: TestCase)


<div id="runDialog" style="display:none;">
  <form id="rcEditor" action="/doEditRunConfiguration" method="post">

  </form>
  <hr/>
  <div id="rcRunner">

  </div>
</div>

<div id="rcRoot@testCase.id">
  @runConfigurationLister(testCase)
</div>


<script type="text/javascript">
$(function(){
  $(".differ2").each(function(index){
    $(this).addClass('vary2' + (index % 2));
  });
});

var runDialog = $( "#runDialog" );
var editorForm = $( "#rcEditor" );
var runnerDiv = $( "#rcRunner" );

function createRunConfiguration(testCaseId){
  $.ajax({
    type: 'GET',
    url: '/createRunConfigurationForm?testCaseId='+testCaseId,
    success: function (data) {
      showCreateDialog(data)
    },
    error: function (jqXHR, textStatus, errorMessage) {
      showError(jqXHR.responseText);
    }
  });
}

function showCreateDialog(data){
  var frm = $('#mainForm');
  frm[0].innerHTML = data;
  executeScripts(frm);
  var parent = $('#rcRoot@testCase.id');

  var dialog = $('#mainDialog').dialog({
       autoOpen: false,
       height: 500,
       width: 800,
       title: 'Create Run Configuration',
       modal: true,
       buttons: {
           "Create": function(){
             $.ajax({
               type: 'post',
               url: '/doCreateRunConfiguration',
               data: frm.serialize(),
               success: function (data) {
                  parent[0].innerHTML = data;
                  executeScripts(parent);
                  dialog.dialog( "close" );
               },
               error: function (jqXHR, textStatus, errorMessage) {
                  frm[0].innerHTML = jqXHR.responseText;
                  executeScripts(frm);
               }
             });
           },
           Cancel: function() {
             dialog.dialog( "close" );
           }
       }
   });

   dialog.dialog( "open", 'Create Run Configuration' );
}

function displayRunConfiguration(id, name){
   //perform ajax to get the run dialog
   $.ajax({
      type: 'GET',
      url: '/editRunConfigurationForm?id='+id,
      success: function (data) {
        showRunDialog(id, data, name)
      },
      error: function (jqXHR, textStatus, errorMessage) {
        showError(jqXHR.responseText);
      }
   });
}

function showRunDialog(id, data, title){
    editorForm[0].innerHTML = data;
    runnerDiv[0].innerHTML = '...'
    executeScripts(editorForm);

    var dialog = runDialog.dialog({
       autoOpen: false,
       height: 600,
       width: 1100,
       title: 'Run Configuration' + title,
       modal: true,
       buttons: {
           "Save": function(){
             $.ajax({
               type: editorForm.attr('method'),
               url: editorForm.attr('action'),
               data: editorForm.serialize(),
               success: function (data) {
                  editorForm[0].innerHTML = data;
                  executeScripts(editorForm);
               },
               error: function (jqXHR, textStatus, errorMessage) {
                   editorForm[0].innerHTML = jqXHR.responseText;
                   editorForm[0].reset();
               }
             });
           },
           "Run": function() {
              ajaxRunRunConfiguration(id)
           },
           Cancel: function() {
             dialog.dialog( "close" );
           }
       },
       close: function() {
         editorForm[0].reset();
       }
   });

   dialog.dialog( "open", title );
}

function ajaxRunRunConfiguration(id){
  $.ajax({
     type: 'GET',
     url: '/doRunRunconfiguration?id' + id ,
     data: editorForm.serialize(),
     success: function (data) {
        if(data.indexOf("TESTFINISH") != -1){
          runnerDiv[0].innerHTML = data;
          executeScripts(runnerDiv);
          setTimeout(function(){
            ajaxRunRunConfiguration(id);
          }, 500);
        }
     },
     error: function (jqXHR, textStatus, errorMessage) {
         runnerDiv[0].innerHTML = jqXHR.responseText;
     }
   });
}

function deleteRunConfiguration(idd, name){
  var parent = $('#rcRoot@testCase.id');
    var deleteDialog = $("#dialog-confirm").dialog({
      resizable: false,
      height:200,
      width:"50%",
      title:'Delete Run Configuration',
      autoOpen: false,
      modal: true,
      buttons: {
        "Delete": function() {
         $.ajax({
            type: 'GET',
            url: '/doDeleteRunConfiguration?id=' + idd,
            success: function (data) {
              parent[0].innerHTML = data;
              executeScripts(parent);
            },
            error: function (jqXHR, textStatus, errorMessage) {
              showError(jqXHR.responseText);
            }
         });
         $( this ).dialog( "close" );
        },
        Cancel: function() {
        $( this ).dialog( "close" );
        }
      }
    });

   deleteDialog.find("span.itemtype")[0].innerHTML = 'run configuration';
   deleteDialog.find("span.itemname")[0].innerHTML = name;
   deleteDialog.dialog( "open" );
}
</script>
